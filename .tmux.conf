# CTRL-Q is much natural than CTRL-B, and doesn't clash with screen's CTRL-A.
# (CTRL-Q = XOFF anyway, which you most likely don't use in the 21st century)
set -g prefix c-q

# Allow to send CTRL-Q
bind-key q send-prefix

# CTRL-Q CTRL-Q goes back to last window, like in screen
bind-key c-q last-window
#set -g base-index 1

# Toggle broadcasting input to all panes. This is THE main reason to use tmux, after all :)
bind-key b set synchronize-panes

# Toggle tmux "mouse" functionality
bind-key m set mouse

# Copy
bind-key Escape copy-mode
# Paste
bind-key p paste-buffer
# Select what buffer to paste
bind-key P choose-buffer
bind-key c-p choose-buffer
# Keys INSIDE copy-mode
bind-key -T copy-mode-vi Escape send -X cancel
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi V send -X select-line
bind-key -T copy-mode-vi C-v send -X rectangle-toggle
bind-key -T copy-mode-vi Enter send -X copy-selection
bind-key -T copy-mode-vi y send -X copy-selection
# Linux:
#bind-key -T copy-mode-vi 'Y' send -X copy-pipe-and-cancel 'xclip -in -selection clipboard'"
# OS X:
#bind-key -T copy-mode-vi 'Y' send -X copy-pipe-and-cancel "reattach-to-user-namespace pbcopy"

# Pane management
bind-key Enter select-pane -m
bind-key S join-pane
bind-key V join-pane -h
bind-key o break-pane

# Various comfort settings stolen from all over the net
set -g default-terminal screen-256color
set -g status-keys vi
set -g renumber-windows on
set -g history-limit 10000
setw -g mode-keys vi
setw -g mouse on
setw -g monitor-activity on
# Automatically set window title
set-window-option -g automatic-rename on
set-option -g set-titles on
# No delay for escape key press
set -sg escape-time 0
# No auto-kill windows after exit
#set-option -g set-remain-on-exit on

# Clear pane
bind-key C send-keys -R \; clear-history
# Redraw
bind-key r refresh-client

# Kill pane/window
bind-key x confirm-before -p "kill-pane #P? (y/n)" kill-pane

# Split vertically
bind-key v split-window -h
# Split horizontally
bind-key s split-window -v
# Window chooser
bind-key "\"" choose-window
# Section+window chooser
bind-key "\'" choose-session
# Rename window
bind-key A command-prompt -I "#W" "rename-window '%%'"
# Rename session
bind-key c-a command-prompt -I "#S" "rename-session '%%'"
# Move pane to window/session
bind-key M choose-window "move-pane -t '%%'"

# Pane layouts
bind-key > next-layout
bind-key < previous-layout

# Pane resize options
bind-key J resize-pane -D 5
bind-key K resize-pane -U 5
bind-key H resize-pane -L 5
bind-key L resize-pane -R 5

# Move panes around
bind , swap-pane -U
bind . swap-pane -D

# Vim style pane selection
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R
bind c-h select-pane -L
bind c-j select-pane -D 
bind c-k select-pane -U
bind c-l select-pane -R
bind [ select-pane -t :.-
bind ] select-pane -t :.+
bind Tab select-pane -t :.+
bind i display-panes

# Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# To interate through windows with space and backspace
bind BSpace previous-window
bind Space next-window
bind n next-window
bind N previous-window

# Paste static texts.
# Useful for in-line configuration of remote servers.
bind-key "\$" load-buffer -b staticsendbuf ~/.kkrc/tmux-inject-bash.txt \; paste-buffer -d -b staticsendbuf
bind-key "%" confirm-before -p "Inject zsh?" "load-buffer -b staticsendbuf ~/.kkrc/tmux-inject-zsh.txt \; paste-buffer -d -b staticsendbuf"
bind-key "*" confirm-before -p "Inject vim?" "load-buffer -b staticsendbuf ~/.kkrc/tmux-inject-vim.txt \; paste-buffer -d -b staticsendbuf"
bind-key "^" confirm-before -p "Inject screen?" "load-buffer -b staticsendbuf ~/.kkrc/tmux-inject-screen.txt \; paste-buffer -d -b staticsendbuf"
bind-key "\\" confirm-before -p "Inject psql?" "load-buffer -b staticsendbuf ~/.kkrc/.psqlrc \; paste-buffer -d -b staticsendbuf"

# Reload tmux config
bind R source-file ~/.tmux.conf\; display "Config reloaded!"

# Theme originally from https://github.com/jimeh/tmux-themepack/blob/master/powerline/block/magenta.tmuxtheme
# and slightly modified
set -g status-fg colour240
set -g status-bg colour233
set -g status-left-bg colour233
set -g status-left-fg colour243
set -g status-left-length 40
set -g status-left "#[fg=colour232,bg=colour125,bold] $USER@#h#{?mouse, [MOUSE],""}#{?synchronize-panes, [BROADCASTING],""} #[fg=colour125,bg=colour240,nobold]#[fg=colour233,bg=colour240] #S #[fg=colour240,bg=colour235]#[fg=colour240,bg=colour235] #I:#P #[fg=colour235,bg=colour233,nobold]"
set -g status-right-bg colour233
set -g status-right-fg colour243
set -g status-right-length 150
set -g status-right "#[fg=colour235,bg=colour233]#[fg=colour240,bg=colour235] %H:%M #[fg=colour240,bg=colour235]#[fg=colour233,bg=colour240] %Y-%m-%d %a #[fg=colour245,bg=colour240]#[fg=colour232,bg=colour245,bold] #{pane_width}x#{pane_height} "
set -g window-status-format " #I:#W#F "
set -g window-status-current-format " #I:#W#F "
set -g window-status-current-bg colour89
set -g window-status-current-fg colour232
set -g window-status-activity-bg colour141 # fg and bg are flipped here due to
set -g window-status-activity-fg colour233 # a bug in tmux
set -g window-status-separator ""
set -g status-justify centre
set -g pane-border-bg default
set -g pane-border-fg colour238
set -g pane-active-border-bg default
set -g pane-active-border-fg colour89
set -g display-panes-colour colour245
set -g display-panes-active-colour colour89
set -g clock-mode-colour colour89
set -g clock-mode-style 24
set -g message-bg colour89
set -g message-fg black
set -g message-command-bg colour233
set -g message-command-fg black
set -g mode-bg colour125
set -g mode-fg colour231

# Local commands:
source-file -q ~/.tmux.local
